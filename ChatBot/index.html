<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE-edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css">
        <title>ChatBot</title>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Baloo+2&display=swap');
            :root {
                --body-bg: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                --msger-bg: #fff;
                --left-msg-bg: linear-gradient(to right, #f895b9, #f44183);
                --right-msg-bg: #ececec;
            }
            html {
                box-sizing: border-box;
            }
            *, 
            *::before,
            *::after {
                margin: 0;
                padding: 0;
                box-sizing: inherit;
            }

            body {
                background-image: var(--body-bg);
                height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                font-family: 'Baloo 2', cursive;
            }
            .msger {
                display: flex;
                flex-flow: column wrap;
                justify-content: space-between;
                width: 100%;
                max-width: 386px;
                margin: 25px 10px;
                border-radius: 10px;
                height: calc(100% - 100px);
                background: var(--msger-bg);
                box-shadow: 0 15px 15px-5px rgba(0, 0, 0, 0.2);
            }
            .msger-header {
                display: flex;
                justify-content: center;
                padding: 10px;
                border-radius: 10px 10px 0 0;
                background: #eee;
                color: #666;
            }
            .msger-header-title {
                display: flex;
                align-items: center;
            }
            .msger-header-title img {
                width: auto;
                height: 2.5rem;
            }
            .msger-header-title p {
                letter-spacing: 1px;
                font-size: 1.8rem;
                font-weight: bold;
            }
            .msger-chat {
                flex: 1;
                overflow-y: auto;
                padding: 10px;
                background-color: #fcfcfe;
            }
            .msger-chat::-webkit-scrollbar {
                width: 6px;
            }
            .msger-chat::-webkit-scrollbar-track {
                background: #ddd;
            }
            .msger-chat::-webkit-scrollbar-thumb {
                background: #bdbdbd;
                border-radius: 10px;
            }
            .msg {
                display: flex;
                align-items: flex-end;
                margin-bottom: 10px;
            }
            .msg:last-of-type {
                margin: 0;
            }
            .msg-img {
                width: 60px;
                height: 60px;
                margin-right: 10px;
                background-repeat: no-repeat;
                background-position: center;
                background-size: cover;
                border-radius: 50%;
            }
            .msg-bubble {
                max-width: 350px;
                padding: 15px;
                border-radius: 15px;
                background: var(--left-msg-bg);
            }
            .msg-info {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .msg-info-name {
                margin-right: 10px;
                font-weight: bold;
            }
            .msg-info-time {
                font-size: 0.85em;
            }
            .left-msg .msg-bubble {
                color: #fff;
                border-bottom-left-radius: 0;
            }
            .right-msg .msg-bubble {
                background: var(--right-msg-bg);
                color: #000;
                border-bottom-right-radius: 0;
            }
            .right-msg {
                flex-direction: row-reverse;
            }
            .right-msg .msg-img {
                margin: 0 0 0 10px;
            }
            .msger-inputarea {
                display: flex;
                padding: 10px;
                background: #f44183;
                border-radius: 0 0 10px 10px;
            }
            .msger-inputarea * {
                padding: 5px;
                border: none;
                border-radius: 3px;
                font-size: 1em;
            }
            .msger-input {
                flex: 1;
                background: transparent;
                outline: none;
                border: 1px solid rgba(255, 255, 255, 0.7);
            }
            .msger-send-btn {
                margin-left: 10px;
                background: transparent;
                color: #fff;
                font-size: 1.5rem;
                cursor: pointer;
            }
        </style>
    </head>
    <body>
    
        <section class="msger">
            <header class="msger-header">
                <div class="msger-header-title">
                    <img src="bot.jpg" alt="">
                    <p>ChatBot</p>
                </div>
            </header>
            <main class="msger-chat">
                <div class="msg left-msg">
                    <div class="msg-img" style="background-image: url(bot.png);"></div>
                    <div class="msg-bubble">
                        <div class="msg-info">
                            <div class="msg-info-name">BOT</div>
                            <div class="msg-info-time">12:45</div>
                        </div>
                        <div class="msg-text">
                            Hi, Welcome to ChatBot!
                        </div>
                    </div>
                </div>
                <div class="msg right-msg">
                    <div class="msg-img" style="background-image: url(user.png);"></div>
                    <div class="msg-bubble">
                        <div class="msg-info">
                            <div class="msg-info-name">Coderider</div>
                            <div class="msg-info-time">12:46</div>
                        </div>
                        <div class="msg-text">
                            Hello, ThankYou!
                        </div>
                    </div>
                </div>
            </main>
            <form action="" class="msger-inputarea">
                <input type="text" class="msger-input" placeholder="Enter your message...">
                <button type="submit" class="msger-send-btn">
                    <i class="fa fa-paper-plane"></i>
                </button>
            </form>
        </section>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            const msgerForm = get(".msger-inputarea");
            const msgerInput = get(".msger-input");
            const msgerChat = get(".msger-chat");

            const BOT_IMG = "bot.jpg";
            const PERSON_IMG = "bot.jpg";
            const BOT_NAME = "BOT";
            const PERSON_NAME = "Coderider";

            const prompts = [
                ["hi", "hey", "hello", "good morning", "good afternoon"],
                ["how are you", "how is life", "how are things"],
                ["what are you doing", "what is going on", "what is up"],
                ["how olad are you"],
                ["who are you", "are you human", "are youo bot", "are you human or bot"],
                ["who created you", "who made you"],
                ["your name please", "your name", "may i know your name", "what is your name", "what call yourself"],
                ["i love you"],
                ["happy", "good", "fun", "wonderful", "fantastic", "cool"],
                ["bad", "bored", "tired"],
                ["help me", "tell  me story", "tell me joke"],
                ["ah", "yes", "ok", "okay", "nice"],
                ["bye", "good bye", "goodbye", "see you later"],
                ["what should i eat today"],
                ["bro"],
                ["what", "why", "how", "where", "when"],
                ["no", "not sure", "maybe", "no thanks"],
                [""],
                ["haha", "ha", "lol", "hehe", "funny", "joke"]
            ];
            const replies = [
                ["Hello!", "Hi!", "Hey!", "Hi there!", "Howdy"],
                ["Fine... how are you?", "Pretty well, how are you?", "Fantastic, how are you?"],
                ["Nothing much", "About to go to sleep", "Can you guess?", "I don't know actually"],
                ["I am infinite"],
                ["i am just a bot", "I am a bot, What are you?"],
                ["The one true God, JavaScript"],
                ["I am nameless", "I don't have a name"],
                ["I love you too", "Me too"],
                ["Have you ever felt bad?", "Glad to hear it"],
                ["Why?", "Why? You shouldn't!", "Try watching TV"],
                ["What about?", "Once upon a time..."],
                ["Tell me a story", "Tell me a joke", "Tell me about yourself"],
                ["Bye", "GoodBye", "See you later"],
                ["Sushi", "Pizza"],
                ["Bro!"],
                ["Great question"],
                ["That's ok", "I understand", "Whta do you want to talk about?"],
                ["Please say something :("],
                ["Haha!", "Good one!"]
            ];
            const alternative = [
                "Same", "Go on...", "Bro...", "Try again", "I'm listening", "I don't understand :/"
            ];
            const robot = [
                "How do you do, fellow human", "I am not a bot"
            ];
            msgerForm.addEventListener("submit", event => {
                event.preventDefault();
                const msgText = msgerInput.value;
                if(!msgText) return;
                msgerInput.value = "";
                addChat(PERSON_NAME, PERSON_IMG, "right", msgText);
                output(msgText);
            });
            function output(input) {
                let product;
                let text = input.toLowerCase().replace(/[^\w\s]/gi, "").replace(/[\d]/gi, "").trim();
                text = text.replace(/ a /g, " ").replace(/i feel /g, "").replace(/whats/g, "what is")
                        .replace(/please /g, "").replace(/ please/g, "").replace(/r u/g, "are you");
                if(compare(prompts, replies, text)) {
                    product = compare(prompts, replies, text);
                } else if (text.match(/thank/gi)) {
                    product = "You're welcome!"
                } else if (text.match(/(robot|bot|robo)/gi)) {
                    product = robot[Math.floor(Math.random() * robot.length)];
                } else {
                    product = alternative[Math.floor(Math.random() * alternative.length)];
                }
                const delay = input.split(" ").length * 100;
                setTimeout(() => {
                    addChat(BOT_NAME, BOT_IMG, "left", product);
                }, delay);
            }
            function compare(propmtsArray, repliesArray, string) {
                let reply;
                let replyFound = false;
                for (let x = 0; x < propmtsArray.length; x++) {
                    for (let y = 0; y < propmtsArray[x].length; y++) {
                        if (propmtsArray[x][y] === string) {
                            let replies = repliesArray[x];
                            reply = replies[Math.floor(Math.random() * replies.length)];
                            replyFound = true;
                            break;
                        }
                    }
                    if (replyFound) {
                        break
                    }
                }
                return reply;
             }
             function addChat(name, img, side, text) {
                const msgHTML = `
                    <div class="msg ${side}-msg">
                        <div class="msg-img" style="background-image: url(${img})"></div>
                        <div class="msg-bubble">
                            <div class="msg-info">
                                <div class="msg-info-name">${name}</div>
                                <div class="msg-info-time">${formatDate(new Date())}</div>
                            </div>
                            <div class="msg-text">${text}</div>
                        </div>
                    </div>
                `;
                msgerChat.insertAdjacentHTML("beforeend", msgHTML);
                msgerChat.scrollTop +=500;
             }
             function get(selector, root = document) {
                return root.querySelector(selector);
             }
             function formatDate(date) {
                const h = "0" + date.getHours();
                const m = "0" + date.getMinutes();
                return `${h.slice(-2)}:${m.slice(-2)}`;
             }
             function random(min, max) {
                return Math.floor(Math.random() * (max - min) + min);
             }
        </script>
    </body>
</html>